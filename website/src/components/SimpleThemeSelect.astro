---
/**
 * Simple Theme Select - Custom theme switcher for SimpleLayout
 *
 * Uses icon buttons instead of dropdown for better UX
 */
---

<div class='theme-selector glass-shell'>
  <button
    class='theme-button'
    data-theme='light'
    aria-label='Light theme'
    title='Light theme'
  >
    <svg
      aria-hidden='true'
      width='20'
      height='20'
      viewBox='0 0 24 24'
      fill='currentColor'
    >
      <path
        d='M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12Zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8ZM11 1h2v3h-2V1Zm0 19h2v3h-2v-3ZM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93v-.001ZM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121Zm2.121-14.85 1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121v-.001ZM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121ZM23 11v2h-3v-2h3ZM4 11v2H1v-2h3Z'
      ></path>
    </svg>
  </button>

  <button
    class='theme-button'
    data-theme='dark'
    aria-label='Dark theme'
    title='Dark theme'
  >
    <svg
      aria-hidden='true'
      width='20'
      height='20'
      viewBox='0 0 24 24'
      fill='currentColor'
    >
      <path
        d='M9.37 5.51A7.35 7.35 0 0 0 9.1 7.5c0 4.08 3.32 7.4 7.4 7.4.68 0 1.35-.09 1.99-.27A7.014 7.014 0 0 1 12 19c-3.86 0-7-3.14-7-7 0-2.93 1.81-5.45 4.37-6.49zM12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z'
      ></path>
    </svg>
  </button>

  <button
    class='theme-button'
    data-theme='auto'
    aria-label='Auto theme'
    title='Auto theme (system)'
  >
    <svg
      aria-hidden='true'
      width='20'
      height='20'
      viewBox='0 0 24 24'
      fill='currentColor'
    >
      <path
        d='M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z'
      ></path>
    </svg>
  </button>
</div>

<style>
  .theme-selector {
    display: flex;
    align-items: center;
    gap: 0.125rem;
    --theme-button-surface: rgba(255, 255, 255, 0.06);
    --theme-button-surface-active: rgba(249, 115, 22, 0.16);
    --theme-button-icon: var(--sl-color-gray-3);
    background: var(--glass-surface, rgba(255, 255, 255, 0.04));
    border: 1px solid var(--glass-border, rgba(255, 255, 255, 0.08));
    backdrop-filter: blur(var(--glass-blur, 12px));
    -webkit-backdrop-filter: blur(var(--glass-blur, 12px));
    border-radius: 12px;
    padding: 0.25rem 0.35rem;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.24);
    position: relative;
    isolation: isolate;
  }

  :root[data-theme='light'] .theme-selector {
    --theme-button-surface: rgba(17, 17, 17, 0.06);
    --theme-button-surface-active: rgba(249, 115, 22, 0.12);
    --theme-button-icon: var(--sl-color-gray-3);
  }

  .theme-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.25rem;
    height: 2.25rem;
    line-height: 1;
    padding: 0;
    border: none;
    background: transparent;
    color: var(--theme-button-icon);
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.2s ease;
    position: relative;
  }

  .theme-button::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--theme-button-surface);
    border-radius: 8px;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .theme-button:hover::before {
    opacity: 1;
  }

  .theme-button:hover {
    color: var(--sl-color-text);
  }

  .theme-button.active {
    color: var(--sl-color-accent-high);
  }

  .theme-button.active::before {
    background: var(--theme-button-surface-active);
    opacity: 1;
  }

  .theme-button svg {
    width: 1.125rem;
    height: 1.125rem;
    position: relative;
    z-index: 1;
  }

  .theme-button:focus-visible {
    outline: 2px solid var(--sl-color-accent);
    outline-offset: 2px;
  }

  @media (max-width: 640px) {
    .theme-button {
      width: 2rem;
      height: 2rem;
    }

    .theme-selector {
      gap: 0.25rem;
    }
  }
</style>

<script>
  type Theme = 'auto' | 'dark' | 'light'

  const storageKey = 'starlight-theme'

  const parseTheme = (theme: unknown): Theme =>
    theme === 'auto' || theme === 'dark' || theme === 'light' ? theme : 'auto'

  const loadTheme = (): Theme =>
    parseTheme(
      typeof localStorage !== 'undefined' && localStorage.getItem(storageKey),
    )

  function storeTheme(theme: Theme): void {
    if (typeof localStorage !== 'undefined') {
      localStorage.setItem(
        storageKey,
        theme === 'light' || theme === 'dark' ? theme : '',
      )
    }
  }

  const getPreferredColorScheme = (): Theme =>
    matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark'

  function updateButtons(theme: Theme) {
    document.querySelectorAll('.theme-button').forEach((button) => {
      const buttonTheme = button.getAttribute('data-theme')
      if (buttonTheme === theme) {
        button.classList.add('active')
      } else {
        button.classList.remove('active')
      }
    })
  }

  function onThemeChange(theme: Theme): void {
    updateButtons(theme)
    document.documentElement.dataset.theme =
      theme === 'auto' ? getPreferredColorScheme() : theme
    storeTheme(theme)
  }

  // Initialize on load
  onThemeChange(loadTheme())

  // React to button clicks
  document.querySelectorAll('.theme-button').forEach((button) => {
    button.addEventListener('click', () => {
      const theme = parseTheme(button.getAttribute('data-theme'))
      onThemeChange(theme)
    })
  })

  // React to changes in system color scheme
  matchMedia('(prefers-color-scheme: light)').addEventListener('change', () => {
    if (loadTheme() === 'auto') onThemeChange('auto')
  })
</script>
