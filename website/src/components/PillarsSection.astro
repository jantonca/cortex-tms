---
/**
 * PillarsSection Component
 *
 * Displays three pillars (Cost, Quality, Sustainability) with viz-bar visualizations
 * Adapted from branding/designs/library liquid glass design
 */
import { TrendingUp, Shield, Leaf, Target } from '@lucide/astro'
import { getCollection } from 'astro:content'
import '../styles/glass-library.css'
import '../styles/pillars-section.css'

// Get pillars from collection
const allHomepageContent = await getCollection('homepage')
const pillars = allHomepageContent
  .filter(
    (entry): entry is typeof entry & {
      data: {
        type: 'pillar'
        icon: 'trending-up' | 'shield' | 'leaf'
        title: string
        description: string
        order: number
        beforeMetric: { label: string; value: string; barWidth: string }
        afterMetric: { label: string; value: string; barWidth: string }
        impactText: string
      }
    } => entry.data.type === 'pillar'
  )
  .sort((a, b) => a.data.order - b.data.order)

// Icon mapping
const iconMap = {
  'trending-up': TrendingUp,
  shield: Shield,
  leaf: Leaf,
}

// Data attribute mapping for pillar types
const pillarDataAttr = {
  'trending-up': 'cost',
  shield: 'quality',
  leaf: 'sustainability',
}
---

<div class="pillars-grid">
  {
    pillars.map((pillar) => {
      const Icon = iconMap[pillar.data.icon]
      const dataAttr = pillarDataAttr[pillar.data.icon]
      return (
        <div class="pillar-card" data-pillar={dataAttr}>
          <div class="pillar-icon">
            <Icon size={24} />
          </div>
          <h3>{pillar.data.title}</h3>
          <p class="pillar-description">{pillar.data.description}</p>

          <div class="pillar-viz">
            <div class="viz-bar">
              <div
                class="viz-bar-fill"
                style={`width: ${pillar.data.beforeMetric.barWidth}; background: rgba(255, 100, 100, 0.3)`}
              />
              <div class="viz-label">{pillar.data.beforeMetric.label}</div>
            </div>
            <div class="viz-bar">
              <div
                class="viz-bar-fill"
                style={`width: ${pillar.data.afterMetric.barWidth}; background: rgba(32, 178, 170, 0.5)`}
              />
              <div class="viz-label">{pillar.data.afterMetric.label}</div>
            </div>
          </div>
          <p class="pillar-impact">
            <Target size={16} /> Impact: {pillar.data.impactText}
          </p>
        </div>
      )
    })
  }
</div>
