---
title: cortex-tms auto-tier
description: Automatically assign HOT/WARM/COLD tiers based on git commit history to reduce manual tier management
---

import { Card, CardGrid, Tabs, TabItem, Steps, Aside } from '@astrojs/starlight/components';

The `cortex-tms auto-tier` command analyzes your git repository's commit history and file patterns to automatically suggest and apply tier tags to documentation files. It uses a scoring system to prioritize high-value documentation while capping HOT files to prevent context bloat, keeping your tiering system aligned with actual work patterns.

## Synopsis

```bash
cortex-tms auto-tier [options]
```

## Description

**Automatic tier management using git history and intelligent scoring**. Auto-tier solves the problem of manually deciding which files should be HOT, WARM, or COLD by combining multiple signals: file importance (canonical docs, core patterns), location (docs structure), and recency (when last modified).

Think of it as `intelligent memory management` for your documentation. Critical reference docs stay HOT, high-value documentation is prioritized, and a hard cap prevents HOT tier explosion. Files are scored and ranked to ensure AI agents see the most relevant context without bloat.

**Typical usage**:
```bash
# Preview what would change
cortex-tms auto-tier --dry-run

# Apply tier tags
cortex-tms auto-tier

# Use custom thresholds for your workflow
cortex-tms auto-tier --hot 14 --warm 60
```

<Aside type="tip" title="Research-Backed">
Auto-tier addresses the ["Lost in the Middle"](https://arxiv.org/abs/2307.03172) research finding: LLMs recall information best from the beginning and end of context, poorly from the middle. By placing recently-modified files (likely relevant) in HOT tier at the context beginning, auto-tier optimizes AI agent performance.
</Aside>

---

## Options

| Option | Default | Description |
|--------|---------|-------------|
| `--hot <days>` | `7` | Files modified within N days get recency bonus in scoring |
| `--warm <days>` | `30` | Files modified within N days ‚Üí WARM tier |
| `--cold <days>` | `90` | Files older than N days ‚Üí COLD tier |
| `--max-hot <count>` | `10` | Maximum number of HOT files (prevents context bloat) |
| `--dry-run`, `-d` | `false` | Preview tier suggestions without applying changes |
| `--force`, `-f` | `false` | Overwrite existing tier tags (default: respect explicit tags) |
| `--verbose`, `-v` | `false` | Show detailed reasons for each tier assignment |

---

## How It Works

<Steps>

1. **Repository Scan**

   Finds all `*.md` files in your repository (excluding `**/node_modules/**`, `.git/**`, `**/dist/**`)

2. **Git History Analysis**

   For each tracked file, runs `git log --follow` to find the last commit timestamp
   - Uses `--follow` to track files across renames
   - Untracked files are skipped (not in git history)

3. **Score Calculation**

   Assigns points to each file based on value signals:
   - **+100 points**: Canonical HOT files (NEXT-TASKS.md, CLAUDE.md, etc.) - highest priority
   - **+40 points**: Documentation files (`docs/` directory)
   - **+10 points**: Core reference docs (`docs/core/` directory)
   - **+15 points**: Recently modified (‚â§ 7 days by default)
   - **-60 points**: Archive files (`docs/archive/` ‚Üí always COLD)

4. **Tier Assignment with Strict Cap**

   Sorts files by score and applies tiering:
   - **Sort by score**: All files ranked (canonical=100, docs/core/+recent=65, etc.)
   - **Apply strict cap**: Top N files (default: 10) become HOT, including canonical
   - **Canonical priority**: Score 100 ensures canonical files naturally fill HOT slots first
   - **Directory conventions**: Non-HOT files use directory rules: `docs/guides/` ‚Üí WARM, `examples/` ‚Üí COLD
   - **Time-based fallback**: Unclassified files use modification time
   - **Explicit tags**: Respected unless `--force` used (except canonical files which can be re-tagged)

5. **Tag Insertion**

   Adds `<!-- @cortex-tms-tier TIER -->` comment at file beginning (or after front matter)

</Steps>

---

## Example Output

**Dry run on cortex-tms repository** (131 files analyzed):

```bash
$ cortex-tms auto-tier --dry-run

üîÑ Git-Based Auto-Tiering

üîç DRY RUN MODE: No files will be modified.

‚úî Analyzed 131 files

üìä Tier Suggestions:

üî• HOT (10 files)
  ‚ú® docs/core/PATTERNS.md
  ‚ú® docs/core/GLOSSARY.md
  ‚ú® NEXT-TASKS.md
  ‚ú® CLAUDE.md
  ‚ú® docs/core/TROUBLESHOOTING.md
  ‚ú® docs/core/SECURITY.md
  ‚ú® docs/core/SCHEMA.md
  ‚ú® docs/core/INFRASTRUCTURE.md
  ‚ú® docs/core/GIT-STANDARDS.md
  ‚ú® docs/core/DOMAIN-LOGIC.md

üìö WARM (57 files)
  ‚ú® docs/core/DECISIONS.md
  ‚ú® docs/core/ARCHITECTURE.md
  ‚ú® docs/guides/CLI-USAGE.md
  ... and 54 more

‚ùÑÔ∏è  COLD (35 files)
  ‚ú® examples/todo-app/README.md
  ‚ú® docs/archive/sprint-v3.1-jan-2026.md
  ... and 33 more

üìà Summary:
  ‚ú® CREATE: 102 new tier tags
  üîÑ UPDATE: 0 tier changes
```

**Performance**: ~300ms for 131 files

---

## Tier Assignment Logic

### Scoring System

Files are scored based on multiple signals (higher score = higher priority for HOT):

| Signal | Points | Description |
|--------|--------|-------------|
| **Canonical HOT** | +100 | Must-have files (NEXT-TASKS.md, CLAUDE.md, etc.) - highest priority |
| **Documentation** | +40 | Files in `docs/` directory |
| **Core docs** | +10 | Additional boost for `docs/core/` |
| **Recent changes** | +15 | Modified within `--hot` days (default: 7) |
| **Archive penalty** | -60 | Files in `docs/archive/` (always COLD) |

### HOT Tier Cap (Strict)

**Maximum HOT files**: Default 10 (configurable via `--max-hot`)

**Strict cap enforcement**: Total HOT files (including canonical) never exceeds --max-hot. Files are sorted by score, and the top N become HOT. Canonical files have highest scores (100), ensuring they naturally fill HOT slots first.

### Special Cases

**Canonical HOT Files** (always HOT, never demoted):
- `NEXT-TASKS.md` - Current sprint tasks
- `CLAUDE.md` - Agent instructions
- `.github/copilot-instructions.md` - GitHub Copilot config
- `docs/core/PATTERNS.md` - Code patterns and conventions
- `docs/core/GLOSSARY.md` - Project terminology

**Untracked Files** (not in git):
- Skipped entirely (not scored or tiered)

**Explicit Tier Tags**:
- Always respected unless `--force` is used

**Renamed Files**:
- `git log --follow` tracks history across renames

---

## Usage Examples

### First-Time Setup

<Tabs>
  <TabItem label="Preview Changes">
    ```bash
    # Safe: preview tier suggestions
    cortex-tms auto-tier --dry-run --verbose

    # Review output, ensure it makes sense
    # Then apply:
    cortex-tms auto-tier
    ```
  </TabItem>

  <TabItem label="Direct Application">
    ```bash
    # Apply tier tags immediately
    cortex-tms auto-tier

    # Commit tier tags to repository
    git add -u
    git commit -m "chore: add tier tags via auto-tier"
    ```
  </TabItem>
</Tabs>

---

### Custom Thresholds for Your Workflow

<Tabs>
  <TabItem label="Fast-Paced Project">
    ```bash
    # Daily commits ‚Üí tight windows
    cortex-tms auto-tier --hot 3 --warm 7 --cold 30

    # Only last 3 days are HOT
    # Files from 4-7 days ago are WARM
    # Anything older than 30 days is COLD
    ```

    **Use case**: Active startup, daily feature releases, rapid iteration
  </TabItem>

  <TabItem label="Slow-Paced Project">
    ```bash
    # Weekly/bi-weekly commits ‚Üí longer windows
    cortex-tms auto-tier --hot 21 --warm 60 --cold 180

    # Last 3 weeks are HOT
    # Files from 4-8 weeks ago are WARM
    # Anything older than 6 months is COLD
    ```

    **Use case**: Enterprise projects, quarterly releases, maintenance mode
  </TabItem>

  <TabItem label="Default (Recommended)">
    ```bash
    # Balanced for most projects
    cortex-tms auto-tier
    # (equivalent to: --hot 7 --warm 30 --cold 90 --max-hot 10)

    # Last week is HOT
    # Files from 1-4 weeks ago are WARM
    # Anything older than 3 months is COLD
    ```

    **Use case**: Standard development cadence, weekly sprints
  </TabItem>

  <TabItem label="Custom HOT Cap">
    ```bash
    # Allow more HOT files for larger context windows
    cortex-tms auto-tier --max-hot 15

    # Strict cap for smaller projects
    cortex-tms auto-tier --max-hot 5

    # No cap (use scoring only, not recommended)
    cortex-tms auto-tier --max-hot 999
    ```

    **Use case**: Adjust based on context window size and project complexity
  </TabItem>
</Tabs>

---

### Weekly Maintenance

```bash
# Run at start of each sprint
cortex-tms auto-tier --force

# Updates all tier tags based on current state
# Ensures tiers stay aligned with work patterns
```

**Why `--force`?**
- Without `--force`: Skips files with existing tier tags
- With `--force`: Overwrites all tier tags
- Use weekly to keep tiers current as project evolves

---

### Integration with Token Analysis

```bash
# Step 1: Apply tier tags
cortex-tms auto-tier

# Step 2: See token distribution
cortex-tms status --tokens

# Output shows:
# HOT files: 70,000 tokens (always in context)
# WARM files: 12,000 tokens (on-demand)
# COLD files: Excluded from analysis
#
# Context Reduction: 85% (70K instead of 82K)
```

**Result**: AI agents read only what matters, costs less, fewer hallucinations

---

## Exit Codes

| Code | Meaning | Scenario |
|------|---------|----------|
| `0` | Success | Tier tags analyzed/applied successfully |
| `1` | Error | Not a git repository, invalid options, git command failed |

**Examples**:
```bash
# Success (git repo, valid options)
$ cortex-tms auto-tier --dry-run
$ echo $?
0

# Error (not a git repo)
$ cortex-tms auto-tier
‚ùå Error: Not a git repository
$ echo $?
1

# Error (invalid threshold)
$ cortex-tms auto-tier --hot foo
‚ùå Error: --hot must be a positive number
$ echo $?
1
```

---

## Detailed Examples

### Verbose Output

```bash
$ cortex-tms auto-tier --dry-run --verbose

üîÑ Git-Based Auto-Tiering

üîç DRY RUN MODE: No files will be modified.

‚úî Analyzed 131 files

üìä Tier Suggestions:

üî• HOT (10 files)
  ‚ú® NEXT-TASKS.md
      Canonical HOT file
  ‚ú® CLAUDE.md
      Canonical HOT file
  ‚ú® docs/core/PATTERNS.md
      Canonical HOT file
  ‚ú® docs/core/TROUBLESHOOTING.md
      High-value doc (score: 65)
  ... (detailed reasons for each file)
```

**Use case**: Understanding why files are tiered the way they are (shows scoring results)

---

### Force Update

<Tabs>
  <TabItem label="Without --force (Default)">
    ```bash
    # First run
    cortex-tms auto-tier
    # ‚ú® CREATE: 81 new tier tags

    # Second run (files already have tags)
    cortex-tms auto-tier
    # ‚úì No changes to apply (existing tags preserved)
    ```

    **Behavior**: Respects existing tier tags
  </TabItem>

  <TabItem label="With --force">
    ```bash
    # First run
    cortex-tms auto-tier
    # ‚ú® CREATE: 81 new tier tags

    # Second run (2 weeks later, with --force)
    cortex-tms auto-tier --force
    # üîÑ UPDATE: 23 tier changes
    # (files moved from HOT‚ÜíWARM as they aged)
    ```

    **Behavior**: Overwrites all tier tags based on current git state
  </TabItem>
</Tabs>

---

### CI/CD Automation

<Tabs>
  <TabItem label="GitHub Actions">
    ```yaml
    # .github/workflows/update-tiers.yml
    name: Weekly Tier Update

    on:
      schedule:
        - cron: '0 0 * * 1'  # Every Monday at midnight
      workflow_dispatch:  # Manual trigger

    jobs:
      update-tiers:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
            with:
              fetch-depth: 0  # Full git history needed

          - name: Setup Node.js
            uses: actions/setup-node@v4
            with:
              node-version: '20'

          - name: Update Tier Tags
            run: npx cortex-tms@latest auto-tier --force

          - name: Commit Changes
            run: |
              git config user.name "github-actions[bot]"
              git config user.email "github-actions[bot]@users.noreply.github.com"
              git add -u
              git commit -m "chore: weekly tier update" || echo "No changes"
              git push
    ```

    **Benefit**: Tiers stay current automatically, no manual work
  </TabItem>

  <TabItem label="Pre-Commit Hook">
    ```bash
    # .git/hooks/pre-commit
    #!/bin/bash

    # Update tier tags before each commit
    npx cortex-tms auto-tier --force --quiet

    # Stage any tier tag changes
    git add -u

    exit 0
    ```

    **Benefit**: Every commit includes up-to-date tier tags
    **Warning**: Adds ~300ms to commit time
  </TabItem>
</Tabs>

---

## Requirements

<Card title="Git Repository Required" icon="github">
  Auto-tier **must** be run in a git-initialized project. It uses git history to determine file recency.

  ```bash
  # Check if git repo
  git status

  # If not, initialize
  git init
  git add .
  git commit -m "Initial commit"

  # Now auto-tier will work
  cortex-tms auto-tier
  ```
</Card>

**Other requirements**:
- Git installed and in PATH
- Files must be committed for accurate history
- Markdown (`.md`) files only

---

## Limitations and Edge Cases

### Current Limitations

**Subdirectory Detection** (coming soon):
```bash
# Currently: Must run from repo root
cd /path/to/repo
cortex-tms auto-tier  # ‚úÖ Works

cd /path/to/repo/docs
cortex-tms auto-tier  # ‚ùå Error: Not a git repository
```

**Workaround**: Always run from repository root

---

**Untracked Files**:
```bash
# Untracked files are skipped (not scored or tiered)
echo "# New Doc" > new-file.md
cortex-tms auto-tier --dry-run

# Output: new-file.md won't appear
# (not in git history, so skipped)

# To tier it: commit first
git add new-file.md
git commit -m "Add new doc"
cortex-tms auto-tier --dry-run
```

**Rationale**: Only committed files have history to analyze

---

**Binary Files**:
```bash
# Only Markdown files are processed
# Images, PDFs, etc. are ignored
```

---

**Performance**:
```bash
# Linear scaling with file count
# 111 files: ~300ms (cortex-tms repo)
# 500 files: ~1.5s
# 1000 files: ~3s
```

For very large repos (1000+ files), consider:
- Running less frequently (monthly instead of weekly)
- Using `--dry-run` to preview before applying

---

### Edge Cases

**Empty Git Repository**:
```bash
git init
cortex-tms auto-tier

# No files tiered (no committed files to analyze)
# Must commit files first for auto-tier to work
```

---

**Renamed Files**:
```bash
# git log --follow tracks renames
git mv OLD.md NEW.md
git commit -m "Rename file"

cortex-tms auto-tier --dry-run
# NEW.md gets proper age (tracks history through rename)
```

---

**Submodules**:
```bash
# Analyzes within submodule context
# Each submodule has its own git history
```

---

## Troubleshooting

### "Not a git repository" Error

**Symptom**:
```bash
$ cortex-tms auto-tier
‚ùå Error: Not a git repository
   Run this command in a git-initialized project.
```

**Causes**:
1. Not in a git repository
2. Running from subdirectory (limitation - must run from repo root)

**Solutions**:

<Tabs>
  <TabItem label="Initialize Git">
    ```bash
    git init
    git add .
    git commit -m "Initial commit"
    cortex-tms auto-tier
    ```
  </TabItem>

  <TabItem label="Navigate to Root">
    ```bash
    # Currently in subdirectory
    pwd
    # /path/to/repo/docs

    # Go to repo root
    cd $(git rev-parse --show-toplevel)

    # Now run auto-tier
    cortex-tms auto-tier
    ```
  </TabItem>
</Tabs>

---

### Invalid Threshold Errors

**Symptom**:
```bash
$ cortex-tms auto-tier --hot foo
‚ùå Error: --hot must be a positive number

$ cortex-tms auto-tier --hot 50 --warm 30
‚ùå Error: --hot threshold must be ‚â§ --warm threshold
   Got: hot=50, warm=30
```

**Solution**: Use valid, ordered thresholds
```bash
# ‚úÖ Correct: hot ‚â§ warm ‚â§ cold
cortex-tms auto-tier --hot 7 --warm 30 --cold 90
```

---

### No Files Changed

**Symptom**:
```bash
$ cortex-tms auto-tier
‚úî Analyzed 50 files
‚úì No changes to apply.
```

**Causes**:
1. All files already have tier tags (use `--force` to update)
2. No Markdown files in repository
3. All files in ignored directories

**Solutions**:

<Tabs>
  <TabItem label="Force Update">
    ```bash
    # Overwrite existing tier tags
    cortex-tms auto-tier --force
    ```
  </TabItem>

  <TabItem label="Check File Count">
    ```bash
    # How many .md files exist?
    find . -name "*.md" -not -path "*/node_modules/*" | wc -l

    # If 0, create some documentation
    ```
  </TabItem>
</Tabs>

---

## Best Practices

<CardGrid stagger>
  <Card title="Start with Dry Run" icon="rocket">
    Always preview tier suggestions before applying:
    ```bash
    cortex-tms auto-tier --dry-run --verbose
    ```
    Review the output to ensure thresholds make sense for your project.
  </Card>

  <Card title="Commit Tier Tags" icon="github">
    Tier tags should be version-controlled:
    ```bash
    cortex-tms auto-tier
    git add -u
    git commit -m "chore: update tier tags"
    ```
    This keeps tiers consistent across the team.
  </Card>

  <Card title="Adjust Thresholds to Workflow" icon="setting">
    Match thresholds to your commit cadence:
    - **Daily commits**: `--hot 3 --warm 7`
    - **Weekly commits**: `--hot 14 --warm 30`
    - **Monthly commits**: `--hot 30 --warm 90`
  </Card>

  <Card title="Run Regularly" icon="approve-check">
    Update tiers periodically as work shifts:
    ```bash
    # Weekly: Before sprint planning
    cortex-tms auto-tier --force

    # Or: Monthly maintenance
    cortex-tms auto-tier --force
    ```
  </Card>
</CardGrid>

---

## Integration with Other Commands

### After Auto-Tier: Verify Token Distribution

```bash
# Apply tier tags
cortex-tms auto-tier

# See how tiers affect token usage
cortex-tms status --tokens

# Verify HOT tier is focused on recent work
```

---

### Before AI Session: Refresh Tiers

```bash
# Update tiers before major AI coding session
cortex-tms auto-tier --force

# Ensures AI sees most relevant context
cortex-tms prompt init-session
```

---

### With Validate: Check Tier Tag Format

```bash
# Apply tier tags
cortex-tms auto-tier

# Verify tags are valid
cortex-tms validate

# Should pass (tier tags don't affect validation)
```

---

## Performance Characteristics

### Measured Performance

**Test repository**: cortex-tms (111 markdown files)

| Operation | Time | Files/Second |
|-----------|------|--------------|
| Dry run | ~300ms | 370 files/s |
| Apply tags | ~340ms | 325 files/s |
| Force update | ~350ms | 315 files/s |

**Scaling**:
- Linear with file count
- Git log is dominant cost (~2-3ms per file)

**Future optimizations** (planned for v3.2+):
- Batched git log for large repos
- Parallel file processing

---

## Related Commands

- [`cortex-tms status --tokens`](/reference/cli/status/) - View token distribution by tier (uses tier tags)
- [`cortex-tms validate`](/reference/cli/validate/) - Health checks (tier tags don't affect validation)
- [`cortex-tms init`](/reference/cli/init/) - Initialize TMS (creates files to be tiered)

---

## Learn More

- [Tiered Memory System](/concepts/tiered-memory/) - Understanding HOT/WARM/COLD tiers
- [Context Budget](/concepts/context-budget/) - Why tier management matters
- ["Lost in the Middle" Research](https://arxiv.org/abs/2307.03172) - Scientific basis for auto-tier

---

<Aside type="note" title="Version">
  The `auto-tier` command was introduced in **Cortex TMS v3.1.0** (January 2026).

  Requires git repository for operation.
</Aside>
